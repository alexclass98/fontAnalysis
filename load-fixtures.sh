#!/bin/bash

echo "üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∏–∫—Å—Ç—É—Ä..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
if ! docker-compose ps backend | grep -q "Up"; then
    echo "‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—ç–∫–µ–Ω–¥–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ó–∞–ø—É—Å–∫–∞–µ–º..."
    docker-compose up -d backend
    sleep 10
fi

# –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∏–∫—Å—Ç—É—Ä—ã
echo "üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–∫—Å—Ç—É—Ä..."
docker-compose exec backend python manage.py loaddata fixtures/initial_data.json

if [ $? -eq 0 ]; then
    echo "‚úÖ –§–∏–∫—Å—Ç—É—Ä—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!"
    echo "üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:"
    echo "   - –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: admin / admin"
    echo "   - –¢–µ—Å—Ç–æ–≤—ã–µ —à–∏—Ñ—Ä—ã: 3 —à—Ç—É–∫–∏"
    echo "   - –¢–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∞–∫—Ü–∏–∏: 3 —à—Ç—É–∫–∏"
    echo "   - –¢–µ—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ: 1 —à—Ç—É–∫–∞"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∏–∫—Å—Ç—É—Ä"
    exit 1
fi
